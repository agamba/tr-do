<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>net.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>net.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">// FILE:            net.h</span>
<a name="l00003"></a>00003 <span class="comment">// derived from WinMTRNet.h (WinMTR 0.8)</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">//    Copyleft (C) 2000-2002, Vasile Laurentiu Stanimir ( stanimir@cr.nivis.com )</span>
<a name="l00006"></a>00006 <span class="comment">//    Modified 2009, Steve Harvey (sgh@vex.net)</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// DESCRIPTION:</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//  In some ways, this code is still a black box.</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 <span class="comment">// NOTES:</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//*****************************************************************************</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#ifndef WINMTRNET_H_</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#define WINMTRNET_H_</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include "dialog.h"</span>
<a name="l00022"></a>00022 
<a name="l00024"></a><a class="code" href="structICMPHeader.html">00024</a> <span class="keyword">struct </span><a class="code" href="structICMPHeader.html" title="per RFC 792, p14">ICMPHeader</a> {
<a name="l00025"></a>00025         __int8 type;
<a name="l00026"></a>00026         __int8 code;
<a name="l00027"></a>00027         __int16 checksum;
<a name="l00028"></a>00028         __int16 id;
<a name="l00029"></a>00029         __int16 sequence;
<a name="l00030"></a>00030 };
<a name="l00031"></a>00031 
<a name="l00033"></a><a class="code" href="structs__nethost.html">00033</a> <span class="keyword">struct </span><a class="code" href="structs__nethost.html" title="characteristics common to a specific hop count in a repeated traceroute">s_nethost</a> {
<a name="l00034"></a><a class="code" href="structs__nethost.html#a4cc3fb1c98245d2ec001d0f0e1b4c59">00034</a>         __int32 <a class="code" href="structs__nethost.html#a4cc3fb1c98245d2ec001d0f0e1b4c59" title="the last known IP address (0=unknown)">addr</a>;                           
<a name="l00035"></a><a class="code" href="structs__nethost.html#badb6cdfcc0c2350885aa95b47aa7e68">00035</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#badb6cdfcc0c2350885aa95b47aa7e68">inconsist</a>;                          
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="structs__nethost.html#8cdffb89972f526b0c55067e0020b26d">00037</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#8cdffb89972f526b0c55067e0020b26d" title="number of outgoing packets already sent with the associated TTL">xmit</a>;                               
<a name="l00038"></a><a class="code" href="structs__nethost.html#0b6bb2ffc189fb7206a4c34a518d9150">00038</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#0b6bb2ffc189fb7206a4c34a518d9150" title="number of outgoing packets which elicited a response">returned</a>;                           
<a name="l00039"></a><a class="code" href="structs__nethost.html#7265e41bd1c39f0ba1dd948339c5aced">00039</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structs__nethost.html#7265e41bd1c39f0ba1dd948339c5aced" title="total of Round Trip Times for all replies in microseconds">total</a>;                    
<a name="l00040"></a><a class="code" href="structs__nethost.html#7b95d9c7c59322b84a96ca2a48cda2b8">00040</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#7b95d9c7c59322b84a96ca2a48cda2b8" title="Round Trip Time for last received reply in microseconds.">last</a>;                               
<a name="l00041"></a><a class="code" href="structs__nethost.html#5700c30e32a122a6d033eeba9c807a37">00041</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#5700c30e32a122a6d033eeba9c807a37" title="lowest Round Trip Time for all received replies">best</a>;                               
<a name="l00042"></a><a class="code" href="structs__nethost.html#434a107e315ea1affe2cf00beba8a2b4">00042</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#434a107e315ea1affe2cf00beba8a2b4" title="highest Round Trip Time for all received replies">worst</a>;                              
<a name="l00043"></a><a class="code" href="structs__nethost.html#cedbbf6771d0cf034f5a31cccc7e41ec">00043</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#cedbbf6771d0cf034f5a31cccc7e41ec">transit</a>;                            
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="structs__nethost.html#5562884958a8e87c3f8e15ff673df81c">00045</a>         <span class="keywordtype">int</span> <a class="code" href="structs__nethost.html#5562884958a8e87c3f8e15ff673df81c" title="most recent saved RTT is last in the array, -1=pending reply, -2=never sent">saved</a>[SAVED_PINGS];                 
<a name="l00046"></a><a class="code" href="structs__nethost.html#8106e956c21d1741e01b7c5d988cdf2b">00046</a>         <span class="keywordtype">char</span> <a class="code" href="structs__nethost.html#8106e956c21d1741e01b7c5d988cdf2b" title="hostname or dotted-quad if not resolvable, or ICMP code or empty">name</a>[255];                         
<a name="l00047"></a>00047 };
<a name="l00048"></a>00048 
<a name="l00050"></a><a class="code" href="structs__sequence.html">00050</a> <span class="keyword">struct </span><a class="code" href="structs__sequence.html" title="a collection of these relates incoming reply packets to what was sent">s_sequence</a> {
<a name="l00051"></a><a class="code" href="structs__sequence.html#f1371408c6fc56b8755249cf8d2a5db3">00051</a>         <span class="keywordtype">int</span> <a class="code" href="structs__sequence.html#f1371408c6fc56b8755249cf8d2a5db3" title="is the hop number (TTL-1) starting from 0">index</a>;                              
<a name="l00052"></a><a class="code" href="structs__sequence.html#23243cbea1f63fecfb2c0fb863e8d8d6">00052</a>         <span class="keywordtype">int</span> <a class="code" href="structs__sequence.html#23243cbea1f63fecfb2c0fb863e8d8d6">transit</a>;                            
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="structs__sequence.html#1d9d66ef454f719fc13cad810a4e9de9">00054</a>         <span class="keywordtype">int</span> <a class="code" href="structs__sequence.html#1d9d66ef454f719fc13cad810a4e9de9" title="number of outgoing packets already sent with the associated TTL">saved_seq</a>;                          
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="structs__sequence.html#b48045a227e47d0d52bf026a1c7b857d">00056</a>         <span class="keyword">struct </span>timeval <a class="code" href="structs__sequence.html#b48045a227e47d0d52bf026a1c7b857d" title="when the outgoing packet was sent">time</a>;                    
<a name="l00057"></a>00057 };
<a name="l00058"></a>00058 
<a name="l00061"></a><a class="code" href="classWinMTRNet.html">00061</a> <span class="keyword">class </span><a class="code" href="classWinMTRNet.html">WinMTRNet</a> {
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="keyword">public</span>:
<a name="l00064"></a>00064 
<a name="l00067"></a>00067         <span class="keywordtype">int</span>             <a class="code" href="classWinMTRNet.html#ac7beed52d6d2d07cbc139a76ce8e3c2">Preopen</a>(<a class="code" href="classWinMTRDialog.html">WinMTRDialog</a> *wp);
<a name="l00068"></a>00068 
<a name="l00074"></a>00074         <span class="keywordtype">int</span>             <a class="code" href="classWinMTRNet.html#98e9dd94f9400ea00c547669a9386fdc">Open</a>(<span class="keywordtype">int</span> address, <span class="keywordtype">int</span> laddress);
<a name="l00075"></a>00075 
<a name="l00077"></a>00077         <span class="keywordtype">void</span>            <a class="code" href="classWinMTRNet.html#f6c26d1d63cf2526d51e02b3e5b48ab5" title="(re)-initialize all saved state">Reset</a>();
<a name="l00078"></a>00078 
<a name="l00080"></a>00080         <span class="keywordtype">void</span>            <a class="code" href="classWinMTRNet.html#2aa4e6997c3b72ac438ee51319cba58c" title="close open socket(s)">Close</a>();
<a name="l00081"></a>00081 
<a name="l00083"></a>00083         <span class="keywordtype">int</span>             <a class="code" href="classWinMTRNet.html#81d1b9da7ce2c49d0b073c2413f4a564" title="return the file descriptor for the receive socket.">GetWaitFd</a>();
<a name="l00084"></a>00084 
<a name="l00086"></a>00086         <span class="keywordtype">void</span>            <a class="code" href="classWinMTRNet.html#2a8bea7d104e21a2f2b31e1356d6106c" title="invoked when a packet is available on the receive socket">ProcessReturn</a>();
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         <span class="comment">// the following get bits of info for display purposes</span>
<a name="l00089"></a>00089         <span class="keywordtype">int</span>             GetLast(<span class="keywordtype">int</span> at);
<a name="l00090"></a>00090         <span class="keywordtype">int</span>             GetMax();
<a name="l00091"></a>00091         <span class="keywordtype">int</span>             GetAddr(<span class="keywordtype">int</span> at);
<a name="l00092"></a>00092         <span class="keyword">const</span> <span class="keywordtype">char</span>*     GetConsistency(<span class="keywordtype">int</span> at);
<a name="l00093"></a>00093         <span class="keywordtype">char</span>*           FmtAddr(<span class="keywordtype">int</span> at, <span class="keywordtype">char</span> *n);
<a name="l00094"></a>00094         <span class="keywordtype">char</span>*           GetName(<span class="keywordtype">int</span> at, <span class="keywordtype">char</span> *n);
<a name="l00095"></a>00095         <span class="keywordtype">void</span>            SetName(<span class="keywordtype">int</span> at, <span class="keywordtype">char</span> *n);
<a name="l00096"></a>00096         <span class="keywordtype">int</span>             GetPercent(<span class="keywordtype">int</span> at);
<a name="l00097"></a>00097         <span class="keywordtype">int</span>             GetBest(<span class="keywordtype">int</span> at);
<a name="l00098"></a>00098         <span class="keywordtype">int</span>             GetWorst(<span class="keywordtype">int</span> at);
<a name="l00099"></a>00099         <span class="keywordtype">int</span>             GetAvg(<span class="keywordtype">int</span> at);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00104"></a>00104         <span class="keywordtype">int</span>             <a class="code" href="classWinMTRNet.html#f12b703c5d313be05f98316c720ce808">SendBatch</a>();
<a name="l00105"></a>00105 
<a name="l00107"></a>00107         <span class="keywordtype">void</span>            <a class="code" href="classWinMTRNet.html#c07a4aa12873781e06b03d9282ccc84b" title="mark all entries in host table as completed (no longer in transit)">EndTransit</a>();
<a name="l00108"></a>00108 
<a name="l00110"></a>00110         <span class="keywordtype">int</span>             <a class="code" href="classWinMTRNet.html#e5b56522d653d3f3478da67e28fa8027" title="calculate Deltatime? as the WaitTime divided by numhosts, in microseconds">CalcDeltatime</a>();
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <span class="keywordtype">int</span>             GetReturned(<span class="keywordtype">int</span> at);
<a name="l00113"></a>00113         <span class="keywordtype">int</span>             GetXmit(<span class="keywordtype">int</span> at);
<a name="l00114"></a>00114         <span class="keywordtype">int</span>             GetTransit(<span class="keywordtype">int</span> at);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         <span class="keywordtype">int</span>*            GetSavedPings(<span class="keywordtype">int</span> at);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         <span class="keywordtype">int</span>             GetNumHosts() { <span class="keywordflow">return</span> numhosts; };
<a name="l00119"></a>00119         BOOL            FullLoop() { <span class="keywordflow">return</span> full_loop; };
<a name="l00120"></a>00120 
<a name="l00123"></a>00123         <span class="keywordtype">void</span>            <a class="code" href="classWinMTRNet.html#1c19487407ac366b7f5f07bf78b183d6">SaveXmit</a>(<span class="keywordtype">int</span> at);
<a name="l00124"></a>00124 
<a name="l00129"></a>00129         <span class="keywordtype">void</span>            <a class="code" href="classWinMTRNet.html#7d99bed3982761bdcaea919af7c84e18">SaveReturn</a>(<span class="keywordtype">int</span> at, <span class="keywordtype">int</span> seq, <span class="keywordtype">int</span> ms);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         <span class="keywordtype">float</span> WaitTime;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <a class="code" href="classWinMTRDialog.html">WinMTRDialog</a> *wmtrdlg;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="keyword">private</span>:
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> Checksum(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>  *lpBuf, <span class="keywordtype">int</span> nLen) ;
<a name="l00139"></a>00139 
<a name="l00143"></a>00143         <span class="keywordtype">int</span> GetNewSequence(<span class="keywordtype">int</span> index);
<a name="l00144"></a>00144 
<a name="l00147"></a>00147         <span class="keywordtype">void</span> SendQuery(<span class="keywordtype">int</span> index);
<a name="l00148"></a>00148 
<a name="l00153"></a>00153         <span class="keywordtype">void</span> ProcessPing(<span class="keywordtype">int</span> seq, __int32 addr, <span class="keyword">struct</span> timeval now);
<a name="l00154"></a>00154 
<a name="l00156"></a>00156         <span class="keywordtype">void</span> skt_close(<span class="keywordtype">int</span> skt);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keywordtype">int</span> packetsize;                         
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="keyword">struct </span><a class="code" href="structs__nethost.html" title="characteristics common to a specific hop count in a repeated traceroute">s_nethost</a> host[MaxHost];         
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         <span class="keyword">struct </span><a class="code" href="structs__sequence.html" title="a collection of these relates incoming reply packets to what was sent">s_sequence</a> sequence[MaxSequence]; 
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordtype">int</span> sendsock;
<a name="l00165"></a>00165         <span class="keywordtype">int</span> recvsock;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <span class="keyword">struct </span>sockaddr_in remoteaddress;
<a name="l00168"></a>00168         <span class="keyword">struct </span>sockaddr_in localaddress;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="keywordtype">int</span> batch_at;                           
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="keywordtype">int</span> numhosts;                           
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         BOOL full_loop;                         
<a name="l00175"></a>00175 };
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="preprocessor">#endif  // ifndef WINMTRNET_H_</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jan 4 20:57:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
